<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HNO₃ Concentration</title>
<link rel="icon" href="favicon.ico">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0F3B66">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  :root {
    --blue-900: #0F3B66;
    --blue-800: #174975;
    --blue-700: #1F4E79;
    --blue-300: #C9D9F0;
    --blue-200: #D9E1F2;
    --blue-100: #EDF3FF;
    --accent:   #2F6CAD;
    --bg: #F7FAFF;
    --card: #FFFFFF;
    --text: #102235;
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #0f141a;
      --card: #18202a;
      --text: #FFFFFF;
      --blue-100: #233142;
      --blue-200: #2b3a4e;
      --blue-300: #3a4d67;
    }
  }
  * { box-sizing: border-box; }
  html, body { background: var(--bg); margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; color: var(--text); }
  .wrap { max-width: 640px; margin: 0 auto; padding: 16px; }
  .topbar {
    display:flex; align-items:center; justify-content: space-between;
    padding: 10px 14px; background: linear-gradient(90deg, var(--blue-200), var(--card));
    border-radius: 14px; margin: 12px 0;
  }
  .brand { display:flex; align-items:center; gap:8px; font-weight:800; color: var(--text); font-size: 18px; }
  .icons-right { display:flex; align-items:center; gap:8px; }
  .icon-btn { display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:8px; border:2px solid var(--blue-300); background:transparent; color: var(--text); }
  .card { background: var(--card); border-radius: 14px; box-shadow: 0 4px 14px rgba(0,0,0,0.08); padding: 16px; margin-top: 14px; }
  label { display:block; font-weight:700; color: var(--text); margin-bottom:8px; }
  input[type=number], input[type=text] { width: 100%; font-size:20px; padding:14px 12px; border:2px solid var(--blue-300); border-radius:12px; color: var(--text); }
  @media (prefers-color-scheme: dark) { input[type=number], input[type=text] { background:#0d1319; border-color: var(--blue-300); } }
  .row { display:grid; grid-template-columns:1fr; gap:14px; }
  .hint { font-size:13px; color:#789; }
  .result { display:flex; align-items:center; justify-content: space-between; font-size:22px; font-weight:800; color: var(--blue-900);
            padding: 12px 14px; border:2px solid var(--blue-300); border-radius:12px; background: var(--blue-100); }
  @media (prefers-color-scheme: dark) { .result { color: var(--text); background:#121a22; border-color: var(--blue-300); } }
  footer { margin: 28px 0 8px; text-align:center; font-size:12px; color:#567; display:flex; align-items:center; justify-content:center; gap:8px; }
  @media (prefers-color-scheme: dark) { footer { color:#9ab; } }
  .footer-icon { width:22px; height:22px; opacity:.6; vertical-align:middle; border-radius:6px; }
  .footer-icon-img { width:22px; height:22px; }

  /* Modal */
  .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.45); display:none; }
  .modal { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); background: var(--card); color: var(--text); width: min(680px, 92vw); max-height: 80vh; overflow:auto; border-radius: 14px; box-shadow: 0 20px 60px rgba(0,0,0,.4); display:none; }
  @media (prefers-color-scheme: dark) { .modal { background:#ffffff; color:#0f141a; } .modal header { border-color: #e5e7eb; } }
  .modal header { padding: 14px 16px; border-bottom: 1px solid var(--blue-300); display:flex; align-items:center; justify-content: space-between; }
  .modal .content { padding: 14px 16px; }
  .close-btn { background: transparent; border: none; font-size: 20px; padding: 6px 10px; color: inherit; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <img src="logo_topbar.png" width="32" height="32" alt="bov icon">
        <span>HNO₃ Concentration</span>
      </div>
      <div class="icons-right">
        <button class="icon-btn" id="aboutOpen" title="About">
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='12' cy='12' r='10'/><line x1='12' y1='16' x2='12' y2='12'/><line x1='12' y1='8' x2='12.01' y2='8'/></svg>' alt="i">
        </button>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label for="temp">Temperature (°C)</label>
          <input id="temp" type="number" inputmode="decimal" step="0.1" placeholder="Insert temperature">
          <div class="hint" id="rangeHint">Valid range: (loading…)</div>
        </div>
        <div>
          <label for="rho">Density (kg/L)</label>
          <input id="rho" type="text" inputmode="decimal" pattern="[0-9,.]*" placeholder="Insert density (e.g. 1,345 or 1.345)">
          <div class="hint">Comma or dot — both work</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="result">
        <div>Concentration</div>
        <div><span id="conc">–</span> <span style="font-weight:600;">%</span></div>
      </div>
      <div id="status" class="hint" style="margin-top:10px;"></div>
    </div>

    <footer>
      <img src="logo_topbar.png" alt="bov logo" class="footer-icon-img">
      <span>Created by bov · 2025</span>
    </footer>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="backdrop"></div>
  <div class="modal" id="aboutModal" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
    <header>
      <strong id="aboutTitle">About this tool</strong>
      <button class="close-btn" id="aboutClose" aria-label="Close">✕</button>
    </header>
    <div class="content">
      <h1>HNO₃ Concentration Calculator</h1>
<p>Calculate nitric acid (HNO₃) concentration (%) from <strong>temperature (°C)</strong> and <strong>density (kg/L)</strong>.</p>
<ul>
<li>Interpolates in temperature</li>
<li>Inverts to concentration using two-nearest points</li>
</ul>
<p><strong>Features</strong>: Mobile-friendly, dark mode, auto-calc, rounds to 1 decimal.</p>
<p><strong>Usage</strong>: Enter Temperature (°C) and Density (kg/L). Comma or dot are both accepted.</p>
<p><strong>Credits</strong>: Created by <strong>bov</strong> ✨</p>
    </div>
  </div>

<script>
// Load numeric table
fetch('data.json').then(r=>r.json()).then(DATA=>{
  window.HNO3_DATA = DATA;
  document.getElementById('rangeHint').textContent = `Valid range: ${DATA.temps[0]}–${DATA.temps[DATA.temps.length-1]} °C`;

  const parseNum = x => { if (!x) return NaN; x = (''+x).trim().replace(',', '.'); return parseFloat(x); };
  function rhoAtT(T) {
    const ts = DATA.temps;
    if (T < ts[0] || T > ts[ts.length-1]) return null;
    let i=0; while (i+1<ts.length && ts[i+1] <= T) i++;
    const out = [];
    for (let r=0;r<DATA.concs.length;r++) {
      const r1 = DATA.rho_grid[r][i], r2 = DATA.rho_grid[r][i+1];
      if (r1==null || r2==null) { out.push(null); continue; }
      const y = r1 + (T-ts[i])*(r2-r1)/(ts[i+1]-ts[i]);
      out.push(y);
    }
    return out;
  }
  function concFromTRho(T,R) {
    const arr = rhoAtT(T); if (!arr) return {status:'outT', conc:null};
    const diffs = []; for (let i=0;i<arr.length;i++) { const v = arr[i]; if (v==null || isNaN(v)) continue; diffs.push([Math.abs(v-R), i]); }
    if (diffs.length < 2) return {status:'few', conc:null};
    diffs.sort((a,b)=>a[0]-b[0]);
    const i1=diffs[0][1], i2=diffs[1][1];
    const R1=arr[i1], R2=arr[i2];
    const C1=DATA.concs[i1], C2=DATA.concs[i2];
    const C = (R2===R1) ? C1 : (C1 + (R - R1)*(C2 - C1)/(R2 - R1));
    return {status:'ok', conc:C};
  }
  const round1 = x => Math.round(x*10)/10;
  const fmt1 = x => x.toLocaleString('en-US', {minimumFractionDigits:1, maximumFractionDigits:1});

  function calculate() {
    const T = parseNum(document.getElementById('temp').value);
    const R = parseNum(document.getElementById('rho').value);
    const out = document.getElementById('conc');
    const st = document.getElementById('status');
    if (isNaN(T) || isNaN(R)) { out.textContent='–'; st.textContent='Enter temperature and density.'; return; }
    const ans = concFromTRho(T,R);
    if (!ans || ans.conc==null) { out.textContent='–'; st.textContent = (ans && ans.status==='outT') ? 'Outside temperature range' : 'Too few values around this temperature'; }
    else { out.textContent = fmt1(round1(ans.conc)); st.textContent='OK'; }
  }
  ['temp','rho'].forEach(id=>{ const el=document.getElementById(id); el.addEventListener('input', calculate); el.addEventListener('keyup', e=>{ if(e.key==='Enter') calculate(); }); });
});

// About modal
const modal = document.getElementById('aboutModal');
const backdrop = document.getElementById('backdrop');
document.getElementById('aboutOpen').addEventListener('click', ()=>{ modal.style.display='block'; backdrop.style.display='block'; });
document.getElementById('aboutClose').addEventListener('click', ()=>{ modal.style.display='none'; backdrop.style.display='none'; });
backdrop.addEventListener('click', ()=>{ modal.style.display='none'; backdrop.style.display='none'; });
</script>
</body>
</html>
