<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HNO₃ Concentration</title>
<link rel="icon" href="favicon.ico">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<style>
  :root {
    --blue-900: #0F3B66;
    --blue-800: #174975;
    --blue-700: #1F4E79;
    --blue-300: #C9D9F0;
    --blue-200: #D9E1F2;
    --blue-100: #EDF3FF;
    --accent:   #2F6CAD;
    --bg: #F7FAFF;
    --card: #FFFFFF;
    --text: #102235;
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #0f141a;
      --card: #18202a;
      --text: #FFFFFF;
      --blue-100: #233142;
      --blue-200: #2b3a4e;
      --blue-300: #3a4d67;
    }
  }
  * { box-sizing: border-box; }
  html, body { background: var(--bg); margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; color: var(--text); }
  .wrap { max-width: 640px; margin: 0 auto; padding: 16px; }
  .topbar {
    display:flex; align-items:center; justify-content: space-between;
    padding: 10px 14px; background: linear-gradient(90deg, var(--blue-200), var(--card));
    border-radius: 14px; margin: 12px 0;
  }
  .brand { display:flex; align-items:center; gap:8px; font-weight:800; color: var(--text); font-size: 18px; }
  .about-btn {
    background: transparent; border: 2px solid var(--blue-300); border-radius:10px; padding:8px 10px; font-weight:700; color: var(--text);
  }
  .card { background: var(--card); border-radius: 14px; box-shadow: 0 4px 14px rgba(0,0,0,0.08); padding: 16px; margin-top: 14px; }
  label { display:block; font-weight:700; color: var(--text); margin-bottom:8px; }
  input[type=number], input[type=text] { width: 100%; font-size:20px; padding:14px 12px; border:2px solid var(--blue-300); border-radius:12px; color: var(--text); }
  @media (prefers-color-scheme: dark) {
    input[type=number], input[type=text] { background:#0d1319; border-color: var(--blue-300); }
  }
  .row { display:grid; grid-template-columns:1fr; gap:14px; }
  .hint { font-size:13px; color:#789; }
  .result { display:flex; align-items:center; justify-content: space-between; font-size:22px; font-weight:800; color: var(--blue-900);
            padding: 12px 14px; border:2px solid var(--blue-300); border-radius:12px; background: var(--blue-100); }
  @media (prefers-color-scheme: dark) { .result { color: var(--text); background:#121a22; border-color: var(--blue-300); } }
  footer { margin: 24px 0 8px; text-align:center; font-size:12px; color:#567; }
  @media (prefers-color-scheme: dark) { footer { color:#9ab; } }

  /* Modal */
  .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.45); display:none; }
  .modal { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); background: var(--card); color: var(--text); width: min(680px, 92vw); max-height: 80vh; overflow:auto; border-radius: 14px; box-shadow: 0 20px 60px rgba(0,0,0,.4); display:none; }
  /* Make the About box white in dark mode */
  @media (prefers-color-scheme: dark) { .modal { background:#ffffff; color:#0f141a; } .modal header { border-color: #e5e7eb; } }
  .modal header { padding: 14px 16px; border-bottom: 1px solid var(--blue-300); display:flex; align-items:center; justify-content: space-between; }
  .modal .content { padding: 14px 16px; }
  .close-btn { background: transparent; border: none; font-size: 20px; padding: 6px 10px; color: inherit; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <img src="data:image/png;base64,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" width="32" height="32" alt="bov icon">
        <span>HNO₃ Concentration</span>
      </div>
      <button class="about-btn" id="aboutOpen">About</button>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label for="temp">Temperature (°C)</label>
          <input id="temp" type="number" inputmode="decimal" step="0.1" placeholder="Insert temperature">
          <div class="hint" id="rangeHint">Valid range: (loading…)</div>
        </div>
        <div>
          <label for="rho">Density (kg/L)</label>
          <input id="rho" type="text" inputmode="decimal" pattern="[0-9,.]*" placeholder="Insert density (e.g. 1,345 or 1.345)">
          <div class="hint">Comma or dot — both work</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="result">
        <div>Concentration</div>
        <div><span id="conc">–</span> <span style="font-weight:600;">%</span></div>
      </div>
      <div id="status" class="hint" style="margin-top:10px;"></div>
    </div>

    <footer>Created by bov</footer>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="backdrop"></div>
  <div class="modal" id="aboutModal" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
    <header>
      <strong id="aboutTitle">About this tool</strong>
      <button class="close-btn" id="aboutClose" aria-label="Close">✕</button>
    </header>
    <div class="content">
      
<h1>HNO₃ Concentration Calculator</h1>
<p>Calculate nitric acid (HNO₃) concentration (%) from <strong>temperature (°C)</strong> and <strong>density (kg/L)</strong>.</p>
<ul>
<li>Interpolates in temperature</li>
<li>Inverts to concentration using two-nearest points</li>
</ul>
<p><strong>Features</strong>: Mobile-friendly, dark mode, auto-calc, rounds to 1 decimal.</p>
<p><strong>Usage</strong>: Enter Temperature (°C) and Density (kg/L). Comma or dot are both accepted.</p>
<p><strong>Credits</strong>: Created by <strong>bov</strong> ✨</p>

    </div>
  </div>

<script>
// Load numeric table
fetch('data.json').then(r=>r.json()).then(DATA=>{
  window.HNO3_DATA = DATA;
  document.getElementById('rangeHint').textContent = `Valid range: ${DATA.temps[0]}–${DATA.temps[DATA.temps.length-1]} °C`;

  const parseNum = x => { if (!x) return NaN; x = (''+x).trim().replace(',', '.'); return parseFloat(x); };
  function rhoAtT(T) {
    const ts = DATA.temps;
    if (T < ts[0] || T > ts[ts.length-1]) return null;
    let i=0; while (i+1<ts.length && ts[i+1] <= T) i++;
    const out = [];
    for (let r=0;r<DATA.concs.length;r++) {
      const r1 = DATA.rho_grid[r][i], r2 = DATA.rho_grid[r][i+1];
      if (r1==null || r2==null) { out.push(null); continue; }
      const y = r1 + (T-ts[i])*(r2-r1)/(ts[i+1]-ts[i]);
      out.push(y);
    }
    return out;
  }
  function concFromTRho(T,R) {
    const arr = rhoAtT(T); if (!arr) return {status:'outT', conc:null};
    const diffs = []; for (let i=0;i<arr.length;i++) { const v = arr[i]; if (v==null || isNaN(v)) continue; diffs.push([Math.abs(v-R), i]); }
    if (diffs.length < 2) return {status:'few', conc:null};
    diffs.sort((a,b)=>a[0]-b[0]);
    const i1=diffs[0][1], i2=diffs[1][1];
    const R1=arr[i1], R2=arr[i2];
    const C1=DATA.concs[i1], C2=DATA.concs[i2];
    const C = (R2===R1) ? C1 : (C1 + (R - R1)*(C2 - C1)/(R2 - R1));
    return {status:'ok', conc:C};
  }
  const round1 = x => Math.round(x*10)/10;
  const fmt1 = x => x.toLocaleString('en-US', {minimumFractionDigits:1, maximumFractionDigits:1});

  function calculate() {
    const T = parseNum(document.getElementById('temp').value);
    const R = parseNum(document.getElementById('rho').value);
    const out = document.getElementById('conc');
    const st = document.getElementById('status');
    if (isNaN(T) || isNaN(R)) { out.textContent='–'; st.textContent='Enter temperature and density.'; return; }
    const ans = concFromTRho(T,R);
    if (!ans || ans.conc==null) { out.textContent='–'; st.textContent = (ans && ans.status==='outT') ? 'Outside temperature range' : 'Too few values around this temperature'; }
    else { out.textContent = fmt1(round1(ans.conc)); st.textContent='OK'; }
  }
  ['temp','rho'].forEach(id=>{ const el=document.getElementById(id); el.addEventListener('input', calculate); el.addEventListener('keyup', e=>{ if(e.key==='Enter') calculate(); }); });
});

// About modal
const modal = document.getElementById('aboutModal');
const backdrop = document.getElementById('backdrop');
document.getElementById('aboutOpen').addEventListener('click', ()=>{ modal.style.display='block'; backdrop.style.display='block'; });
document.getElementById('aboutClose').addEventListener('click', ()=>{ modal.style.display='none'; backdrop.style.display='none'; });
backdrop.addEventListener('click', ()=>{ modal.style.display='none'; backdrop.style.display='none'; });
</script>
</body>
</html>
