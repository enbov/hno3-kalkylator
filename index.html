<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HNO₃ koncentration</title>
<style>
  :root {
    --blue-900: #0F3B66;
    --blue-700: #1F4E79;
    --blue-200: #D9E1F2;
    --blue-100: #EAF1FB;
    --blue-050: #F5F8FE;
    --accent:   #2F6CAD;
  }
  html, body {
    background: var(--blue-050);
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    color: #112;
  }
  .wrap {
    max-width: 640px;
    margin: 0 auto;
    padding: 16px;
  }
  .card {
    background: white;
    border-radius: 14px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    padding: 16px;
    margin-top: 14px;
  }
  h1 {
    font-size: 22px;
    margin: 0;
    padding: 14px 16px;
    background: linear-gradient(90deg, var(--blue-200), #ffffff);
    border-radius: 12px;
    color: var(--blue-700);
    text-align: center;
    letter-spacing: 0.3px;
  }
  label {
    display: block;
    font-weight: 600;
    color: var(--blue-700);
    margin-bottom: 8px;
  }
  input[type=number] {
    width: 100%;
    font-size: 20px;
    padding: 14px 12px;
    border: 2px solid var(--blue-200);
    border-radius: 12px;
    background: #fff;
    outline: none;
    -webkit-appearance: none;
  }
  input[type=number]:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(47,108,173,0.15);
  }
  .row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 14px;
  }
  .btn {
    width: 100%;
    background: var(--accent);
    color: white;
    font-size: 18px;
    font-weight: 700;
    padding: 14px 16px;
    border-radius: 12px;
    border: none;
  }
  .btn:active {
    transform: translateY(1px);
  }
  .result {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 22px;
    font-weight: 700;
    color: var(--blue-900);
    padding: 12px 14px;
    border: 2px solid var(--blue-200);
    border-radius: 12px;
    background: #F7FAFF;
  }
  .hint {
    font-size: 13px; color: #456; opacity: .9; margin-top: 6px;
  }
  .status-ok { color: #1B7742; font-weight: 700; }
  .status-bad { color: #B23B3B; font-weight: 700; }
  footer {
    margin: 24px 0 8px; text-align: center; font-size: 12px; color: #567;
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>HNO₃ koncentration</h1>
    <div class="card">
      <div class="row">
        <div>
          <label for="temp">Temperatur (°C)</label>
          <input id="temp" type="number" inputmode="decimal" step="0.1" placeholder="t.ex. 40" value="40">
          <div class="hint">Giltigt intervall: 0–100 °C</div>
        </div>
        <div>
          <label for="rho">Densitet (kg/L)</label>
          <input id="rho" type="number" inputmode="decimal" step="0.001" placeholder="t.ex. 1,345 eller 1.345" value="1.345">
          <div class="hint">Använd komma eller punkt – båda fungerar</div>
        </div>
        <button class="btn" id="calcBtn">Beräkna</button>
      </div>
    </div>

    <div class="card">
      <div class="result">
        <div>Koncentration</div>
        <div><span id="conc">–</span> <span style="font-weight:600;">%</span></div>
      </div>
      <div id="status" class="hint" style="margin-top:10px;"></div>
    </div>

    <footer>Bygger på tabell ur Perry/HandyMath. Interpolation i T och inversion i C.</footer>
  </div>

<script>
// Embedded data (temps, concs, rho_grid)
const DATA = {"temps": [0, 5, 10, 15, 20, 25, 30, 40, 50, 60, 80, 100], "concs": [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0, 20.0, 21.0, 22.0, 23.0, 24.0, 25.0, 26.0, 27.0, 28.0, 29.0, 30.0, 31.0, 32.0, 33.0, 34.0, 35.0, 36.0, 37.0, 38.0, 39.0, 40.0, 41.0, 42.0, 43.0, 44.0, 45.0, 46.0, 47.0, 48.0, 49.0, 50.0, 51.0, 52.0, 53.0, 54.0, 55.0, 56.0, 57.0, 58.0, 59.0, 60.0, 61.0, 62.0, 63.0, 64.0, 65.0, 66.0, 67.0, 68.0, 69.0, 70.0, 71.0, 72.0, 73.0, 74.0, 75.0, 76.0, 77.0, 78.0, 79.0, 80.0, 81.0, 82.0, 83.0, 84.0, 85.0, 86.0, 87.0, 88.0, 89.0, 90.0, 91.0, 92.0, 93.0, 94.0, 95.0, 96.0, 97.0, 98.0, 99.0, 100.0], "rho_grid": [[1.0058, 1.00572, 1.00534, 1.00464, 1.00364, 1.00241, 1.0009, 0.9973, 0.9931, 0.9882, 0.9767, 0.9632], [1.0117, 1.01149, 1.01099, 1.01018, 1.00909, 1.00778, 1.0061, 1.0025, 0.9982, 0.9932, 0.9816, 0.9681], [1.0176, 1.0173, 1.01668, 1.01576, 1.01457, 1.01318, 1.0114, 1.0077, 1.0033, 0.9982, 0.9865, 0.973], [1.0236, 1.02315, 1.0224, 1.02137, 1.02008, 1.01861, 1.0168, 1.0129, 1.0084, 1.0033, 0.9915, 0.9779], [1.0296, 1.02904, 1.02816, 1.02702, 1.02563, 1.02408, 1.0222, 1.0182, 1.0136, 1.0084, 0.9965, 0.9829], [1.0357, 1.03497, 1.03397, 1.03272, 1.03122, 1.02958, 1.0277, 1.0235, 1.0188, 1.0136, 1.0015, 0.9879], [1.0418, 1.041, 1.0399, 1.0385, 1.0369, 1.0352, 1.0333, 1.0289, 1.0241, 1.0188, 1.0066, 0.9929], [1.048, 1.0471, 1.0458, 1.0443, 1.0427, 1.0409, 1.0389, 1.0344, 1.0295, 1.0241, 1.0117, 0.998], [1.0543, 1.0532, 1.0518, 1.0502, 1.0485, 1.0466, 1.0446, 1.0399, 1.0349, 1.0294, 1.0169, 1.0032], [1.0606, 1.0594, 1.0578, 1.0561, 1.0543, 1.0523, 1.0503, 1.0455, 1.0403, 1.0347, 1.0221, 1.0083], [1.0669, 1.0656, 1.0639, 1.0621, 1.0602, 1.0581, 1.056, 1.0511, 1.0458, 1.0401, 1.0273, 1.0134], [1.0733, 1.0718, 1.07, 1.0681, 1.0661, 1.064, 1.0618, 1.0567, 1.0513, 1.0455, 1.0326, 1.0186], [1.0797, 1.0781, 1.0762, 1.0742, 1.0721, 1.0699, 1.0676, 1.0624, 1.0568, 1.0509, 1.0379, 1.0238], [1.0862, 1.0845, 1.0824, 1.0803, 1.0781, 1.0758, 1.0735, 1.0681, 1.0624, 1.0564, 1.0432, 1.0289], [1.0927, 1.0909, 1.0887, 1.0865, 1.0842, 1.0818, 1.0794, 1.0739, 1.068, 1.0619, 1.0485, 1.0341], [1.0992, 1.0973, 1.095, 1.0927, 1.0903, 1.0879, 1.0854, 1.0797, 1.0737, 1.0675, 1.0538, 1.0393], [1.1057, 1.1038, 1.1014, 1.0989, 1.0964, 1.094, 1.0914, 1.0855, 1.0794, 1.0731, 1.0592, 1.0444], [1.1123, 1.1103, 1.1078, 1.1052, 1.1026, 1.1001, 1.0974, 1.0913, 1.0851, 1.0787, 1.0646, 1.0496], [1.1189, 1.1168, 1.1142, 1.1115, 1.1088, 1.1062, 1.1034, 1.0972, 1.0908, 1.0843, 1.07, 1.0547], [1.1255, 1.1234, 1.1206, 1.1178, 1.115, 1.1123, 1.1094, 1.1031, 1.0966, 1.0899, 1.0754, 1.0598], [1.1322, 1.13, 1.1271, 1.1242, 1.1213, 1.1185, 1.1155, 1.109, 1.1024, 1.0956, 1.0808, 1.065], [1.1389, 1.1366, 1.1336, 1.1306, 1.1276, 1.1247, 1.1217, 1.115, 1.1083, 1.1013, 1.0862, 1.0701], [1.1457, 1.1433, 1.1402, 1.1371, 1.134, 1.131, 1.128, 1.121, 1.1142, 1.107, 1.0917, 1.0753], [1.1525, 1.1501, 1.1469, 1.1437, 1.1404, 1.1374, 1.1343, 1.1271, 1.1201, 1.1127, 1.0972, 1.0805], [1.1594, 1.1569, 1.1536, 1.1503, 1.1469, 1.1438, 1.1406, 1.1332, 1.126, 1.1185, 1.1027, 1.0857], [1.1663, 1.1638, 1.1603, 1.1569, 1.1534, 1.1502, 1.1469, 1.1394, 1.132, 1.1244, 1.1083, 1.091], [1.1733, 1.1707, 1.167, 1.1635, 1.16, 1.1566, 1.1533, 1.1456, 1.1381, 1.1303, 1.1139, 1.0963], [1.1803, 1.1777, 1.1738, 1.1702, 1.1666, 1.1631, 1.1597, 1.1519, 1.1442, 1.1362, 1.1195, 1.1016], [1.1874, 1.1847, 1.1807, 1.177, 1.1733, 1.1697, 1.1662, 1.1582, 1.1503, 1.1422, 1.1251, 1.1069], [1.1945, 1.1917, 1.1876, 1.1838, 1.18, 1.1763, 1.1727, 1.1645, 1.1564, 1.1482, 1.1307, 1.1122], [1.2016, 1.1988, 1.1945, 1.1906, 1.1867, 1.1829, 1.1792, 1.1708, 1.1625, 1.1542, 1.1363, 1.1175], [1.2088, 1.2059, 1.2014, 1.1974, 1.1934, 1.1896, 1.1857, 1.1772, 1.1687, 1.1602, 1.1419, 1.1228], [1.216, 1.2131, 1.2084, 1.2043, 1.2002, 1.1963, 1.1922, 1.1836, 1.1749, 1.1662, 1.1476, 1.1281], [1.2233, 1.2203, 1.2155, 1.2113, 1.2071, 1.203, 1.1988, 1.1901, 1.1812, 1.1723, 1.1533, 1.1335], [1.2306, 1.2275, 1.2227, 1.2183, 1.214, 1.2098, 1.2055, 1.1966, 1.1876, 1.1784, 1.1591, 1.139], [1.2375, 1.2344, 1.2294, 1.2249, 1.2205, 1.2163, 1.2119, 1.2028, 1.1936, 1.1842, 1.1645, 1.144], [1.2444, 1.2412, 1.2361, 1.2315, 1.227, 1.2227, 1.2182, 1.2089, 1.1995, 1.1899, 1.1699, 1.149], [1.2513, 1.2479, 1.2428, 1.2381, 1.2335, 1.2291, 1.2245, 1.215, 1.2054, 1.1956, 1.1752, 1.154], [1.2581, 1.2546, 1.2494, 1.2446, 1.2399, 1.2354, 1.2308, 1.221, 1.2112, 1.2013, 1.1805, 1.1589], [1.2649, 1.2613, 1.256, 1.2511, 1.2463, 1.2417, 1.237, 1.227, 1.217, 1.2069, 1.1858, 1.1638], [1.2717, 1.268, 1.2626, 1.2576, 1.2527, 1.248, 1.2432, 1.233, 1.2229, 1.2126, 1.1911, 1.1687], [1.2786, 1.2747, 1.2692, 1.2641, 1.2591, 1.2543, 1.2494, 1.239, 1.2287, 1.2182, 1.1963, 1.1735], [1.2854, 1.2814, 1.2758, 1.2706, 1.2655, 1.2606, 1.2556, 1.245, 1.2345, 1.2238, 1.2015, 1.1783], [1.2922, 1.288, 1.2824, 1.2771, 1.2719, 1.2669, 1.2618, 1.251, 1.2403, 1.2294, 1.2067, 1.1831], [1.299, 1.2947, 1.289, 1.2836, 1.2783, 1.2732, 1.268, 1.257, 1.2461, 1.235, 1.2119, 1.1879], [1.3058, 1.3014, 1.2955, 1.2901, 1.2847, 1.2795, 1.2742, 1.263, 1.2519, 1.2406, 1.2171, 1.1927], [1.3126, 1.308, 1.3021, 1.2966, 1.2911, 1.2858, 1.2804, 1.269, 1.2577, 1.2462, 1.2223, 1.1976], [1.3194, 1.3147, 1.3087, 1.3031, 1.2975, 1.2921, 1.2867, 1.275, 1.2635, 1.2518, 1.2275, 1.2024], [1.3263, 1.3214, 1.3153, 1.3096, 1.304, 1.2984, 1.2929, 1.2811, 1.2693, 1.2575, 1.2328, 1.2073], [1.3327, 1.3277, 1.3215, 1.3157, 1.31, 1.3043, 1.2987, 1.2867, 1.2748, 1.2628, 1.2377, 1.2118], [1.3391, 1.3339, 1.3277, 1.3218, 1.316, 1.3102, 1.3045, 1.2923, 1.2802, 1.268, 1.2425, 1.2163], [1.3454, 1.3401, 1.3338, 1.3278, 1.3219, 1.316, 1.3102, 1.2978, 1.2856, 1.2731, 1.2473, 1.2208], [1.3517, 1.3462, 1.3399, 1.3338, 1.3278, 1.3218, 1.3159, 1.3033, 1.2909, 1.2782, 1.2521, 1.2252], [1.3579, 1.3523, 1.3459, 1.3397, 1.3336, 1.3275, 1.3215, 1.3087, 1.2961, 1.2833, 1.2568, 1.2296], [1.364, 1.3583, 1.3518, 1.3455, 1.3393, 1.3331, 1.327, 1.3141, 1.3013, 1.2883, 1.2615, 1.2339], [1.37, 1.3642, 1.3576, 1.3512, 1.3449, 1.3386, 1.3324, 1.3194, 1.3064, 1.2932, 1.2661, 1.2382], [1.3759, 1.37, 1.3634, 1.3569, 1.3505, 1.3441, 1.3377, 1.3246, 1.3114, 1.2981, 1.2706, 1.2424], [1.3818, 1.3757, 1.3691, 1.3625, 1.356, 1.3495, 1.343, 1.3298, 1.3164, 1.3029, 1.2751, 1.2466], [1.3875, 1.3813, 1.3747, 1.368, 1.3614, 1.3548, 1.3482, 1.3348, 1.3213, 1.3077, 1.2795, 1.2507], [1.3931, 1.3868, 1.3801, 1.3734, 1.3667, 1.36, 1.3533, 1.3398, 1.3261, 1.3124, 1.2839, 1.2547], [1.3986, 1.3922, 1.3855, 1.3787, 1.3719, 1.3651, 1.3583, 1.3447, 1.3308, 1.3169, 1.2881, 1.2587], [1.4039, 1.3975, 1.3907, 1.3838, 1.3769, 1.37, 1.3632, 1.3494, 1.3354, 1.3213, 1.2922, 1.2625], [1.4091, 1.4027, 1.3958, 1.3888, 1.3818, 1.3748, 1.3679, 1.354, 1.3398, 1.3255, 1.2962, 1.2661], [null, 1.4078, 1.4007, 1.3936, 1.3866, 1.3795, 1.3725, null, null, null, null, null], [null, 1.4128, 1.4055, 1.3984, 1.3913, 1.3841, 1.377, null, null, null, null, null], [null, 1.4177, 1.4103, 1.4031, 1.3959, 1.3887, 1.3814, null, null, null, null, null], [null, 1.4224, 1.415, 1.4077, 1.4004, 1.3932, 1.3857, null, null, null, null, null], [null, 1.4271, 1.4196, 1.4122, 1.4048, 1.3976, 1.39, null, null, null, null, null], [null, 1.4317, 1.4241, 1.4166, 1.4091, 1.4019, 1.3942, null, null, null, null, null], [null, 1.4362, 1.4285, 1.421, 1.4134, 1.4061, 1.3983, null, null, null, null, null], [null, 1.4406, 1.4328, 1.4252, 1.4176, 1.4102, 1.4023, null, null, null, null, null], [null, 1.4449, 1.4371, 1.4294, 1.4218, 1.4142, 1.4063, null, null, null, null, null], [null, 1.4491, 1.4413, 1.4335, 1.4258, 1.4182, 1.4103, null, null, null, null, null], [null, 1.4532, 1.4454, 1.4376, 1.4298, 1.4221, 1.4142, null, null, null, null, null], [null, 1.4573, 1.4494, 1.4415, 1.4337, 1.4259, 1.418, null, null, null, null, null], [null, 1.4613, 1.4533, 1.4454, 1.4375, 1.4296, 1.4217, null, null, null, null, null], [null, 1.4652, 1.4572, 1.4492, 1.4413, 1.4333, 1.4253, null, null, null, null, null], [null, 1.469, 1.461, 1.4529, 1.445, 1.4369, 1.4288, null, null, null, null, null], [null, 1.4727, 1.4647, 1.4565, 1.4486, 1.4404, 1.4323, null, null, null, null, null], [null, 1.4764, 1.4683, 1.4601, 1.4521, 1.4439, 1.4357, null, null, null, null, null], [null, 1.48, 1.4718, 1.4636, 1.4555, 1.4473, 1.4391, null, null, null, null, null], [null, 1.4835, 1.4753, 1.467, 1.4589, 1.4507, 1.4424, null, null, null, null, null], [null, 1.4869, 1.4787, 1.4704, 1.4622, 1.454, 1.4456, null, null, null, null, null], [null, 1.4903, 1.482, 1.4737, 1.4655, 1.4572, 1.4487, null, null, null, null, null], [null, 1.4936, 1.4852, 1.4769, 1.4686, 1.4603, 1.4518, null, null, null, null, null], [null, 1.4968, 1.4883, 1.4799, 1.4716, 1.4633, 1.4548, null, null, null, null, null], [null, 1.4999, 1.4913, 1.4829, 1.4745, 1.4662, 1.4577, null, null, null, null, null], [null, 1.5029, 1.4942, 1.4858, 1.4773, 1.469, 1.4605, null, null, null, null, null], [null, 1.5058, 1.497, 1.4885, 1.48, 1.4716, 1.4631, null, null, null, null, null], [null, 1.5085, 1.4997, 1.4911, 1.4826, 1.4741, 1.4656, null, null, null, null, null], [null, 1.5111, 1.5023, 1.4936, 1.485, 1.4766, 1.4681, null, null, null, null, null], [null, 1.5136, 1.5048, 1.496, 1.4873, 1.4789, 1.4704, null, null, null, null, null], [null, 1.5156, 1.5068, 1.4979, 1.4892, 1.4807, 1.4722, null, null, null, null, null], [null, 1.5177, 1.5088, 1.4999, 1.4912, 1.4826, 1.4741, null, null, null, null, null], [null, 1.5198, 1.5109, 1.5019, 1.4932, 1.4846, 1.4761, null, null, null, null, null], [null, 1.522, 1.513, 1.504, 1.4952, 1.4867, 1.4781, null, null, null, null, null], [null, 1.5244, 1.5152, 1.5062, 1.4974, 1.4889, 1.4802, null, null, null, null, null], [null, 1.5278, 1.5187, 1.5096, 1.5008, 1.4922, 1.4835, null, null, null, null, null], [null, 1.5327, 1.5235, 1.5144, 1.5056, 1.4969, 1.4881, null, null, null, null, null], [null, 1.5402, 1.531, 1.5217, 1.5129, 1.504, 1.4952, null, null, null, null, null]]};

// Helper: parse number with comma or dot
function parseNum(x) {
  if (typeof x === 'number') return x;
  if (!x) return NaN;
  x = (''+x).trim().replace(',', '.');
  return parseFloat(x);
}

// Linear interpolation
function lerp(x1, y1, x2, y2, x) {
  if (x2 === x1) return y1;
  return y1 + (x - x1) * (y2 - y1) / (x2 - x1);
}

// Given T, return array rho_T for each C row via T-interpolation
function rhoAtT(T) {
  const temps = DATA.temps;
  const cols = temps.length;
  if (T < temps[0] || T > temps[cols-1]) return null;

  // find T1 index
  let i = 0;
  while (i+1 < cols && temps[i+1] <= T) i++;
  const T1 = temps[i];
  const T2 = temps[i+1];

  const rho_T = [];
  for (let r=0; r<DATA.concs.length; r++) {
    const r1 = DATA.rho_grid[r][i];
    const r2 = DATA.rho_grid[r][i+1];
    if (r1 == null || r2 == null) { rho_T.push(null); continue; }
    rho_T.push( lerp(T1, r1, T2, r2, T) );
  }
  return {T1, T2, rho_T};
}

// Invert rho(T,C) -> C by 2-nearest interpolation (robust vs non-monotonic)
function concFromTRho(T, rho) {
  const rt = rhoAtT(T);
  if (!rt) return { status: 'Utanför temperaturintervall', conc: null };

  // Build [absdiff, idx] list ignoring nulls
  const diffs = [];
  for (let i=0; i<rt.rho_T.length; i++) {
    const v = rt.rho_T[i];
    if (v == null || isNaN(v)) continue;
    diffs.push([Math.abs(v - rho), i]);
  }
  if (diffs.length < 2) return { status: 'För få värden vid denna temperatur', conc: null };

  diffs.sort((a,b)=> a[0]-b[0]);
  const i1 = diffs[0][1], i2 = diffs[1][1];
  const R1 = rt.rho_T[i1], R2 = rt.rho_T[i2];
  const C1 = DATA.concs[i1], C2 = DATA.concs[i2];

  let C;
  if (R2 === R1) C = C1;
  else C = C1 + (rho - R1)*(C2 - C1)/(R2 - R1);

  return { status: 'OK', conc: C };
}

function format1(x) {
  if (x == null || isNaN(x)) return '–';
  return (Math.round(x*10)/10).toLocaleString('sv-SE', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
}

function go() {
  const t = parseNum(document.getElementById('temp').value);
  const r = parseNum(document.getElementById('rho').value);
  const out = document.getElementById('conc');
  const st  = document.getElementById('status');

  if (isNaN(t) || isNaN(r)) {
    out.textContent = '–';
    st.innerHTML = '<span class="status-bad">Fyll i temperatur och densitet.</span>';
    return;
  }

  const ans = concFromTRho(t, r);
  if (ans.conc == null) {
    out.textContent = '–';
    st.innerHTML = '<span class="status-bad">'+ans.status+'</span>';
  } else {
    out.textContent = format1(ans.conc);
    st.innerHTML = '<span class="status-ok">OK</span>';
  }
}

document.getElementById('calcBtn').addEventListener('click', go);
// Calculate once on load
go();
</script>
</body>
</html>
